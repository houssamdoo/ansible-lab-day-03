# Ansible: Ansible playbooks - Install HTTPD

## ðŸ”¹ Step 01: create index.html

- Copies from `<playbook_dir>/files/index.html` on the Ansible control node
- Places it in Apache's default document root (`/var/www/html/`)
- Sets appropriate ownership (`apache:apache`) and permissions (`0644`)
- Triggers a graceful reload of httpd if the file changes

### Preparation Steps:

- Create a files directory in the same location as your playbook
- Place your custom index.html in this directory
- Directory structure should look like:

```bash
â”œâ”€â”€ install_httpd.yml
â””â”€â”€ templates/
    â””â”€â”€ index.html
```

```html
hello
```

## ðŸ”¹ Step 02: Update the Ansible Playbook

`httpd.yaml` file.

```yaml
---
- name: Install and configure Apache HTTP Server on RHEL 9
  hosts: all
  become: yes
  tasks:
    - name: Install httpd package
      yum:
        name: httpd
        state: present

    - name: Ensure httpd service is running and enabled
      service:
        name: httpd
        state: started
        enabled: yes

    - name: Copy custom index.html to web root
      copy:
        src: ./templates/index.html # Local file from Ansible control node
        dest: /var/www/html/index.html
        owner: apache
        group: apache
        mode: 0644
      notify:
        - Reload httpd

    - name: Open firewall ports for HTTP/HTTPS (optional)
      ansible.builtin.firewalld:
        service: "{{ item }}"
        permanent: yes
        immediate: yes
        state: enabled
      loop:
        - http
        - https
      notify:
        - Reload firewalld
      when:
        - ansible_os_family == 'RedHat'
        - ansible_distribution_major_version == '9'

  handlers:
    - name: Reload firewalld
      ansible.builtin.service:
        name: firewalld
        state: reloaded

    - name: Reload httpd
      ansible.builtin.service:
        name: httpd
        state: reloaded
```

## ðŸ”¹ Step 03: Launch Playbook

```bash
ansible-playbook all -i inventory httpd.yaml
```

# Concepts

## handlers

In Ansible, handlers are special tasks that run only when notified by other tasks. They are typically used to perform actions after a change is made, such as restarting a service or reloading a configuration. Handlers are idempotent, meaning they run once even if triggered multiple times.

### Key Features of Handlers:

- **Triggered by Notifications**: A task "notifies" a handler if it makes a change.
- **Run Once**: Even if notified multiple times, a handler runs only once at the end of the playbook.
- **Order of Execution**: Handlers run in the order they are defined in the handlers section (not the order of notification).

#### NOTE

**Handlers in Ansible execute only if the task that notifies them reports a change.**

### How It Works:

1. **Task Runs**: A task with a notify directive executes.

2. **Check for Change**:
   - If the task **_changes_** the system (e.g., modifies a file, installs a package), it triggers the handler.
   - If the task **_does not change_** the system (e.g., the file is already up-to-date), the handler is **_not_** triggered.
3. **Handler Execution**: All notified handlers run **_once_** at the end of the playbook.
